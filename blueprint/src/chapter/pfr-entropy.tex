\chapter{Entropy version of PFR}

\begin{definition}\label{eta-def}
 \lean{eta}\leanok
  $\eta := 1/9$.
\end{definition}

Throughout this chapter,  $G = \F_2^n$, and $X^0_1, X^0_2$ are $G$-valued random variables.

\begin{definition}[$\tau$ functional]\label{tau-def}
  \uses{eta-def}
  \lean{tau}
If $X_1,X_2$ are two $G$-valued random variables, then
$$  \tau[X_1; X_2] \coloneqq \dist{X_1}{X_2} + \eta  \dist{X^0_1}{X_1} + \eta \dist{X^0_2}{X_2}.$$
\end{definition}

\begin{lemma}[$\tau$ depends only on distribution]\label{tau-copy}
  \uses{tau-def}
  \lean{tau-copy}  If $X'_1, X'_2$ are copies of $X_1,X_2$, then $\tau[X'_1;X'_2] = \tau[X_1;X_2]$.
\end{lemma}


\begin{proof}\uses{copy-ent} Immediate from Lemma \ref{copy-ent}.
\end{proof}

\begin{definition}[$\tau$-minimizer]\label{tau-min-def}
\uses{tau-def}
\lean{tau-minimizes}
A pair of $G$-valued random variables $X_1, X_2$ are said to be a $\tau$-minimizer if one has
  $$\tau[X_1;X_2] \leq \tau[X'_1;X'_2]
  $$
for all $G$-valued random variables $X'_1, X'_2$.
\end{definition}


\begin{proposition}[$\tau$ has minimum]\label{tau-min}\uses{tau-minimizes}
  \lean{tao-min-exists}
A pair $X_1, X_2$ of $\tau$-minimizers exist.
\end{proposition}

\begin{proof} By Lemma \ref{tau-copy}, $\tau$ only depends on the probability distributions of $X_1, X_2$. This ranges over a compact space, and $\tau$ is continuous.  So $\tau$ has a minimum.
\end{proof}

\subsection{Basic facts about minimizers}

In this section we assume that $X_1,X_2$ are $\tau$-minimizers. We also write $k := d[X_1;X_2]$.

\begin{lemma}[Distance lower bound]\label{distance-lower}
  \uses{tau-minimizes, ruz-dist-def}
  \lean{distance_ge_of_min}
  For any $G$-valued random variables $X'_1,X'_2$, one has
$$ d[X'_1;X'_2] \geq k - \eta (d[X^0_1;X'_1] - d[X^0_1;X_1] ) - - \eta (d[X^0_2;X'_2] - d[X^0_2;X_2] ).$$
\end{lemma}

\begin{proof}
  \uses{tau-def, tau-minimizes}
  Immediate from Definition \ref{tau-def} and Definition \ref{tau-minimizes}.
\end{proof}

\begin{lemma}[Conditional distance lower bound]\label{cond-distance-lower}
  \uses{tau-minimizes, cond-dist-def, ruz-dist-def}
  \lean{condDistance_ge_of_min}
  For any $G$-valued random variables $X'_1,X'_2$ and random variables $Z,W$, one has
$$ d[X'_1|Z;X'_2|W] \geq k - \eta (d[X^0_1;X'_1|Z] - d[X^0_1;X_1] ) - - \eta (d[X^0_2;X'_2|W] - d[X^0_2;X_2] ).$$
\end{lemma}

\begin{proof}\uses{distance-lower}  Apply Lemma \ref{distance-lower} to conditioned random variables and then average.
\end{proof}

\subsection{First estimate}

We continue the assumptions from the preceding section.

Let $X_1, X_2, \tilde X_1, \tilde X_2$ be independent random variables, with $X_1,\tilde X_1$ copies of $X_1$ and $X_2,\tilde X_2$ copies of $X_2$.  (This is possible thanks to Lemma \ref{independent-exist}.)

We also define the quantity
$$ I_1 :=  I [ X_1+X_2 : \tilde X_1 + X_2 | X_1+X_2+\tilde X_1+\tilde X_2 ].$$


\begin{lemma}[First estimate]\label{first-estimate}
  \lean{first-estimate} We have $I_1 \leq 2 \eta k$.
\end{lemma}

\begin{proof}\uses{cor-fibre, distance-lower, cor-distance-lower, first-useful}  From Corollary \ref{cor-fibre} we have
  \begin{align*}
    &   d[X_1+\tilde X_2;X_2+\tilde X_1] + d[X_1|X_1+\tilde X_2; X_2|X_2+\tilde X_1] \\
    &\quad + I[ X_1+ X_2 : \tilde X_1 + X_2 \,|\, X_1 + X_2 + \tilde X_1 + \tilde X_2 ] = 2k.
    \end{align*}
From Lemma \ref{distance-lower}, Lemma \ref{cor-distance-lower} we haave
\begin{align*}
  d[X_1+\tilde X_2; X_2+\tilde X_1] \geq k &- \eta (d[X^0_1; X_1+\tilde X_2] - d[X^0_1; X_1]) \\& \qquad- \eta (d[X^0_2; X_2+\tilde X_1] - d[X^0_2; X_2])
\end{align*}
and
\begin{align*}
  \nonumber
  & d[X_1|X_1+\tilde X_2; X_2|X_2+\tilde X_1]  \\ \nonumber & \qquad\quad \geq k - \eta (d[X^0_1; X_1 | X_1 + \tilde X_2] - d[X^0_1; X_1]) \\
  & \qquad\qquad\qquad\qquad  - \eta(d[X^0_2; X_2 | X_2 + \tilde X_1] - d[X^0_2; X_2]).
\end{align*}
It therefore suffices to prove that
\begin{align}
\nonumber
&(d[X_1^0;X_1+\tilde X_2]-\dist[X_1^0;X_1] + (d[X_2^0;X_2+\tilde X_1]-d[X_2^0;X_2])\\
&\qquad \qquad +(d[X_1^0;X_1|X_1+\tilde X_2]-d[X_1^0;X_1]) \nonumber \\ & \qquad \qquad \qquad \qquad  +(d\dist[X_2^0; X_2|X_2+\tilde X_1]-d[X_2^0;X_2]) \leq 2k.
\label{suff-for-first-est}
\end{align}

By Lemma \ref{first-useful} (and recalling that $k$ is defined to be $d[X_1;X_2]$) we have
\[ d[X^0_1; X_1+\tilde X_2] - d[X^0_1; X_1] \leq \tfrac{1}{2} k + \tfrac{1}{4} H[X_2] - \tfrac{1}{4} H[X_1],\] \[  d[X^0_2;X_2+\tilde X_1] - d[X^0_2; X_2] \leq \tfrac{1}{2} k + \tfrac{1}{4} H[X_1] - \tfrac{1}{4} H[X_2],\]
\begin{equation}  d[X_1^0;X_1|X_1+\tilde X_2] - \dist[X_1^0;X_1] \leq \tfrac{1}{2} k + \tfrac{1}{4} H[X_1] - \tfrac{1}{4} H[X_2]                                 \label{second-dist1}
\end{equation}
and
\begin{equation}
  \label{second-dist2}
  d[X_2^0; X_2|X_2+\tilde X_1] - d[X_2^0; X_2] \leq \tfrac{1}{2}k + \tfrac{1}{4} H[X_2] - \tfrac{1}{4} H[X_1].
\end{equation}
Adding all these inequalities, we obtain~\eqref{suff-for-first-est}.
\end{proof}

\begin{lemma}\label{foursum-bound}
  \uses{entropy-def}
  \lean{ent_ofsum_le}
  With the same notation, we have
  \begin{equation}
    \label{HS-bound}
    H[X_1+X_2+\tilde X_1+\tilde X_2] \le \tfrac{1}{2} H[X_1]+\tfrac{1}{2} H[X_2] + (2 + \eta) k - I_1.
  \end{equation}
\end{lemma}

\begin{proof}\uses{first-estimate, ruz-indep}
  Subtracting~\eqref{second-tc2} from~\eqref{second-main}, and combining the resulting inequality with~\eqref{second-dist1} and~\eqref{second-dist2} (Note: these should all be extracted as separate lemmas) gives the bound
\[
  \dist{X_1+\tilde X_2}{X_2+\tilde X_1} \le (1 + \eta) k - I_1,
\]
and the claim follows from Lemma \ref{ruz-indep}.
\end{proof}


\subsection{Second estimate}

We continue the assumptions from the preceding section.
We introduce the quantity
$$ I_2 := I[ X_1+X_2 : X_1 + \tilde X_1 | X_1+X_2+\tilde X_1+\tilde X_2 ].$$

\begin{lemma}[Second estimate]\label{second-estimate}
We have
$$ I_2 \leq 2 \eta k + \frac{2 \eta (2 \eta k - I_1)}{1 - \eta}.$$
\end{lemma}

\begin{proof}
  \uses{cor-fibre,distance-lower,cond-distance-lower,first-useful,ruz-indep,foursum-bound}
  We apply Corollary \ref{cor-fibre}, but now with the choice
  \[
    (Y_1,Y_2,Y_3,Y_4) := (X_2, X_1, \tilde X_2, \tilde X_1).
  \]
  Now Corollary \ref{cor-fibre} can be rewritten as
  \begin{align*}
    &d[X_1+\tilde X_1;X_2+\tilde X_2] + d[X_1|X_1+\tilde X_1; X_2|X_2+\tilde X_2] \\
    &\quad + I[ X_1+X_2 : X_1 + \tilde X_1 \,|\, X_1+X_2+\tilde X_1+\tilde X_2 ] = 2k,
  \end{align*}
  recalling once again that $k := d[X_1;X_2]$.  From Lemma \ref{distance-lower}, Lemma \ref{cond-distance-lower} as before, one has
  \begin{align}
    \nonumber
    d[X_1+\tilde X_; X_2+\tilde X_2] \geq k &- \eta(d[X^0_1;X_1] - d[X^0_1;X_1+\tilde X_1]) \\
    &- \eta(d[X^0_2;X_2] - d[X^0_2;X_2+\tilde X_2])
  \label{1122}
  \end{align}
  and
  \begin{align*}
    d[X_1|X_1+\tilde X_1; X_2|X_2+\tilde X_2]   \geq k &- \eta (d[X^0_1;X_1] - d[X^0_1;X_1|X_1+\tilde X_1]) \\& - \eta (d[X^0_2;X_2] - d[X^0_2;X_2|X_2+\tilde X_2]) .
  \end{align*}
  Now Lemma \ref{first-useful} gives
  \begin{equation}\label{1122a} d[X^0_1;X_1+\tilde X_1] - d[X^0_1;X_1] \leq \tfrac{1}{2} d[X_1;X_1],\end{equation}
  \begin{equation}\label{1122b}
    d[X^0_2;X_2+\tilde X_2] - d[X^0_2;X_2] \leq \tfrac{1}{2} d[X_2;X_2],
  \end{equation}
  \[
    d[X^0_1;X_1|X_1+\tilde X_1] -  d[X^0_1;X_1] \leq  \tfrac{1}{2} d[X_1;X_1],
  \]
  and
  \[
    d[X^0_2;X_2|X_2+\tilde X_2] -  d[X^0_2;X_2] \leq \tfrac{1}{2} d[X_1;X_2].
    \]
  Combining all these inequalities and cancelling terms, we obtain
  \begin{equation}\label{combined}
  I[ X_1+X_2 : X_1 + \tilde X_1 | X_1+X_2+\tilde X_1+\tilde X_2 ] \leq \eta ( d[X_1; X_1] + d[X_2; X_2] ).
  \end{equation}
By combining~\eqref{1122},~\eqref{1122a} and~\eqref{1122b}, we obtain
  \begin{equation}\label{d12}
    d[X_1+\tilde X_1; X_2+\tilde X_2] \geq k - \frac{\eta}{2} ( d[X_1; X_1] + d[X_2;X_2] ).
  \end{equation}
  We may also use Lemma \ref{ruz-indep} to expand
  \begin{align*}
   & d[X_1+\tilde X_1;X_2+\tilde X_2] \\ &= H[ X_1+\tilde X_1 + X_2 + \tilde X_2 ]  - \tfrac{1}{2} H[X_1+\tilde X_1] - \tfrac{1}{2} H[X_2+\tilde X_2] \\
    &= H[ X_1+\tilde X_1 + X_2 + \tilde X_2]  - \tfrac{1}{2} H[X_1] - \tfrac{1}{2} H[X_2]  \\ & \qquad\qquad\qquad   - \tfrac{1}{2} \left( d[X_1;X_1] + d[X_2; X_2] \right),
  \end{align*}
  and hence by Lemma \ref{foursum-bound}
  \[
    d[X_1+\tilde X_1; X_2+\tilde X_2] \leq (2+\eta) k - \tfrac{1}{2} \left( d[X_1;X_1] + d[X_2;X_2] \right) - I_1.
  \]
  Combining this bound with~\eqref{d12} we obtain
  \[ d[X_1;X_1] + d[X_2;X_2] \leq 2 k + \frac{2(2 \eta k - I_1)}{1-\eta}. \]
  Therefore by~\eqref{combined} we have the desired bound.
\end{proof}


\subsection{Endgame}

Let $X_1,X_2,\tilde X_1,\tilde X_2$ be as before, and introduce the random variables
\[ U \coloneqq X_1 + X_2, \qquad V \coloneqq \tilde X_1 + X_2, \qquad W \coloneqq X_1 + \tilde X_1\] and
\[   S \coloneqq X_1 + X_2 + \tilde X_1 + \tilde X_2.\]

\begin{lemma}\label{uvw-s}
\uses{conditional-information-def}
\lean{sum_condMutual_le}
We have
$$
I(U : V \, | \, S) + I(V : W \, | \,S) + I(W : U \, | \, S) \leq 6 \eta k - \frac{1 - 5 \eta}{1-\eta} (2 \eta k - I_1).
$$
\end{lemma}

\begin{proof}
  \uses{first-estimate, second-estimate}
From the definitions of $I_1,I_2$ (and some entropy lemma to deal with the third term), we see that
\[
  I_1 = I{U : V \, | \, S}, \qquad I_2 = I{W : U \, | \, S}, \qquad I_2 = I{V : W \, | \,S}.
\]
Applying Lemma \ref{first-estimate} and Lemma \ref{second-estimate} we have the inequalities
\[   I_2 \leq 2 \eta k + \frac{2\eta(2 \eta k - I_1)}{1-\eta} .
\]
Summing these two inequalities gives
$$
   I_1 + I_2 + I_2 \leq I_1+4\eta k+ \frac{4\eta(2 \eta k - I_1)}{1-\eta}
$$
and the claim follows from some calculation.
\end{proof}

...



\begin{theorem}[$\tau$-decrement]\label{de-prop}
  \uses{tau-def, ruz-dist-def}
  \lean{tau-strictly-decreases}
  Let $X_1, X_2$ be two $G$-valued random variables with $d[X_1;X_2] > 0$. Then there are $G$-valued random variables $X'_1, X'_2$ such that
$$\tau[X'_1;X'_2] < \tau[X_1;X_2].
$$
\end{theorem}

\begin{proof}  Sorry!
\end{proof}


\subsection{Conclusion}

\begin{theorem}[Entropy version of PFR]\label{entropy-pfr}\uses{ruz-dist-def}
  \lean{entropic_PFR_conjecture}
  Let $G = \F_2^n$, and suppose that $X^0_1, X^0_2$ are $G$-valued random variables.
  Then there is some subgroup $H \leq G$ such that
  \[
    d[X^0_1;U_H] + d[X^0_2;U_H] \le 11 d[X^0_1;X^0_2],
  \]
  where $U_H$ is uniformly distributed on $H$.denotes the uniform distribution on $H$.
  Furthermore, both $\dist{X^0_1}{U_H}$ and $\dist{X^0_2}{U_H}$ are at most $6 \dist{X^0_1}{X^0_2}$.
\end{theorem}

Probably need a definition for a uniform distribution on a non-empty subset $H$ of a set $S$.

\begin{proof} \uses{de-prop, tau-min, lem:100pc, ruzsa-triangle}  Let $X_1, X_2$ be the $\tau$-minimizer from Lemma \ref{tau-min}.  From Theorem \ref{de-prop}, $d[X_1;X_2]=0$.  From Lemma \ref{lem:100pc}, $d[X_1;U_H] = d[X_2; U_H] = 0$.  Also from $\tau$-minimization we have $\tau[X_1;X_2] \leq \tau[X^0_1;X^0_2]$.  Using this and the Ruzsa triangle inequality we can conclude.
\end{proof}

Note: a ``stretch goal'' for this project would be to obtain a `decidable` analogue of this result (see the remark at the end of Section 2 for some related discussion).
