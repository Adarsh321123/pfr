\chapter{The 100\% version of PFR}

\begin{lemma}\label{lem:100pc}
  \uses{ruz-dist-def}
  \lean{dist_eq_zero_iff}
  Suppose that $X_1,X_2$ are $G$-valued random variables such that
  $d[X_1;X_2]=0$. Then there exists a subgroup $H \leq G$ such that $d[X_1;U_H] = d[X_2;U_H] = 0$.
\end{lemma}

\begin{proof}
  \uses{ruzsa-indep, relabeled-entropy-cond,ruzsa-triangle}
Using Lemma \ref{ruzsa-triangle} we may assume wlog that $X_1,X_2$ have the same distribution.
   Without loss of generality we may take $X_1,X_2$ to be independent.  Let $A$ denote the range of $X_1$ (or of $X_2$).  From Lemma \ref{ruzsa-indep} we have
  $$ H[X_1-X_2] = H[X_1].$$
Observe from Lemma \ref{relabeled-entropy-cond} that
$$ H[X_1-X_2|X_2] = H[X_1|X_2] = H[X_1]$$
and hence by Lemma \ref{alternative-mutual}
$$ I[ X_1-X_2 : X_1 ] = 0.$$
By Corollary \ref{entropy}, $X_1-X_2$ and $X_1$ are therefore independent, thus the law of $(X_1-X_2|X_1=x)$ does not depend on $x \in A$.  This implies that $x-X_2$ and $y-X_2$ have the same law if $x,y \in A$, so in particular $A$ is invariant under $A-A$.  This implies that $A$ is a translate of $A-A$, and that $H := A-A$ is a subgroup.  The law of $X_1$ is now $H$-invariant on a coset of $H$, and so $X_1 = x + U_H$ for some $x$.  The claim then follows.
\end{proof}
